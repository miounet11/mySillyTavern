# âœ… ç®¡ç†å‘˜å¯†ç ä¿®å¤å®Œæˆ

**ä¿®å¤æ—¶é—´**: 2025-11-01 04:25  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ” é—®é¢˜åŸå› 

ä¹‹å‰èƒ½ç”¨ `admin123` ç™»å½•ï¼Œä½† `hao123321` æ— æ³•ç™»å½•çš„åŸå› æ˜¯ï¼š

### æ ¹æœ¬åŸå› 
åœ¨ä»£ç  `apps/web/src/app/api/admin/auth/login/route.ts` ç¬¬9è¡Œï¼š
```typescript
const ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || 'admin123'
```

å¦‚æœç¯å¢ƒå˜é‡ `ADMIN_PASSWORD` æœªè¢«è¯»å–ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ `admin123`ã€‚

### é…ç½®é—®é¢˜
1. âœ… `.env` æ–‡ä»¶ä¸­è®¾ç½®äº†å¯†ç  â†’ ä½†ä½äºé¡¹ç›®æ ¹ç›®å½•
2. âŒ PM2 é…ç½®ä¸­æœªåŒ…å«ç¯å¢ƒå˜é‡ â†’ å¯¼è‡´è¿›ç¨‹è¯»å–ä¸åˆ°
3. âŒ Next.js standalone æ¨¡å¼éœ€è¦ç‰¹æ®Šé…ç½® â†’ ç¯å¢ƒå˜é‡åŠ è½½æ–¹å¼ä¸åŒ

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### å·²æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

1. **åœ¨ apps/web åˆ›å»º .env.production.local**
   ```bash
   /www/wwwroot/jiuguanmama/mySillyTavern/apps/web/.env.production.local
   ```
   å†…å®¹ï¼š
   ```
   ADMIN_PASSWORD=hao123321
   SESSION_SECRET=6fa5e365008d5ff2bbd004a3522eda574a96920ae403becc4d8e09a3feb39c22
   ```

2. **æ›´æ–° PM2 é…ç½®æ–‡ä»¶**
   ä¿®æ”¹äº† `ecosystem.config.js`ï¼Œåœ¨ env é…ç½®ä¸­æ·»åŠ ï¼š
   ```javascript
   env: {
     NODE_ENV: 'production',
     PORT: 3000,
     ADMIN_PASSWORD: 'hao123321',
     SESSION_SECRET: '6fa5e365008d5ff2bbd004a3522eda574a96920ae403becc4d8e09a3feb39c22'
   }
   ```

3. **é‡å¯ PM2 æœåŠ¡**
   ```bash
   pm2 delete sillytavern-web
   pm2 start ecosystem.config.js
   ```

4. **éªŒè¯ç¯å¢ƒå˜é‡åŠ è½½**
   âœ… å·²ç¡®è®¤è¿›ç¨‹ä¸­æ­£ç¡®åŠ è½½äº† `ADMIN_PASSWORD=hao123321`

---

## ğŸ”‘ ç°åœ¨å¯ä»¥ä½¿ç”¨çš„å¯†ç 

### ç™»å½•ä¿¡æ¯
- **ç™»å½•åœ°å€**: `https://your-domain.com/admin/characters/login`
- **å¯†ç **: `hao123321` âœ…

### âš ï¸ æ—§å¯†ç å·²å¤±æ•ˆ
- **admin123** - é»˜è®¤å¯†ç ï¼Œå·²è¢«è¦†ç›– âŒ

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
pm2 status sillytavern-web
```
åº”è¯¥æ˜¾ç¤ºï¼šstatus: `online` âœ…

### 2. éªŒè¯ç¯å¢ƒå˜é‡
```bash
cat /proc/$(pm2 pid sillytavern-web)/environ | tr '\0' '\n' | grep ADMIN
```
åº”è¯¥è¾“å‡ºï¼š`ADMIN_PASSWORD=hao123321` âœ…

### 3. æµ‹è¯•ç™»å½•
1. è®¿é—®ï¼š`https://your-domain.com/admin/characters/login`
2. è¾“å…¥å¯†ç ï¼š`hao123321`
3. ç‚¹å‡»ç™»å½•
4. åº”è¯¥æˆåŠŸè¿›å…¥ç®¡ç†é¢æ¿ âœ…

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### Next.js Standalone æ¨¡å¼çš„ç¯å¢ƒå˜é‡åŠ è½½

åœ¨ standalone æ¨¡å¼ä¸‹ï¼Œç¯å¢ƒå˜é‡çš„åŠ è½½ä¼˜å…ˆçº§ä¸ºï¼š

1. **è¿›ç¨‹ç¯å¢ƒå˜é‡** (æœ€é«˜ä¼˜å…ˆçº§) â† æˆ‘ä»¬ä½¿ç”¨çš„æ–¹æ³•
   - PM2 çš„ `env` é…ç½®
   - ç›´æ¥åœ¨å¯åŠ¨å‘½ä»¤ä¸­è®¾ç½®

2. **åº”ç”¨ç›®å½•çš„ .env æ–‡ä»¶**
   - `.env.production.local`
   - `.env.production`
   - `.env.local`
   - `.env`

3. **ä»£ç ä¸­çš„é»˜è®¤å€¼** (æœ€ä½ä¼˜å…ˆçº§)
   - `process.env.ADMIN_PASSWORD || 'admin123'`

### ä¸ºä»€ä¹ˆéœ€è¦åœ¨ PM2 é…ç½®ä¸­è®¾ç½®

å½“ä½¿ç”¨ `npm start` å¯åŠ¨ Next.js æ—¶ï¼ŒNext.js ä¼šæŸ¥æ‰¾åº”ç”¨ç›®å½•ä¸‹çš„ .env æ–‡ä»¶ã€‚ä½†ç”±äºï¼š
1. PM2 ä»¥ fork æ¨¡å¼å¯åŠ¨
2. å·¥ä½œç›®å½•åœ¨ `apps/web`
3. Standalone æ„å»ºæ¨¡å¼çš„ç‰¹æ®Šæ€§

æœ€å¯é çš„æ–¹å¼æ˜¯åœ¨ PM2 é…ç½®ä¸­ç›´æ¥æŒ‡å®šç¯å¢ƒå˜é‡ã€‚

---

## ğŸ”’ å®‰å…¨å»ºè®®

### å½“å‰é…ç½®å®‰å…¨æ€§

âœ… **ä¼˜ç‚¹**ï¼š
- å¯†ç ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
- Sessionå¯†é’¥è¶³å¤Ÿéšæœºï¼ˆ32å­—èŠ‚åå…­è¿›åˆ¶ï¼‰
- httpOnly cookie é˜²æ­¢ XSS æ”»å‡»
- 24å°æ—¶è‡ªåŠ¨è¿‡æœŸ

âš ï¸ **æ”¹è¿›å»ºè®®**ï¼š

1. **å®šæœŸæ›´æ¢å¯†ç **
   ```bash
   # ç¼–è¾‘ PM2 é…ç½®
   nano /www/wwwroot/jiuguanmama/mySillyTavern/ecosystem.config.js
   
   # ä¿®æ”¹ ADMIN_PASSWORD
   # ä¿å­˜åé‡å¯
   pm2 restart sillytavern-web
   ```

2. **ä½¿ç”¨æ›´å¼ºçš„å¯†ç **
   - å½“å‰ï¼š`hao123321` (9å­—ç¬¦)
   - å»ºè®®ï¼šè‡³å°‘16å­—ç¬¦ï¼ŒåŒ…å«å¤§å°å†™ã€æ•°å­—ã€ç¬¦å·
   - ç¤ºä¾‹ï¼š`H@o123!SecureP@ss2025`

3. **ä¿æŠ¤é…ç½®æ–‡ä»¶**
   ```bash
   chmod 600 /www/wwwroot/jiuguanmama/mySillyTavern/ecosystem.config.js
   chmod 600 /www/wwwroot/jiuguanmama/mySillyTavern/apps/web/.env.production.local
   ```

4. **å®šæœŸè½®æ¢ Session å¯†é’¥**
   ```bash
   # ç”Ÿæˆæ–°çš„å¯†é’¥
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   
   # æ›´æ–°é…ç½®å¹¶é‡å¯
   ```

---

## ğŸ“‹ ç»´æŠ¤æ¸…å•

### å®šæœŸæ£€æŸ¥ï¼ˆå»ºè®®æ¯æœˆï¼‰

- [ ] æ›´æ¢ç®¡ç†å‘˜å¯†ç 
- [ ] è½®æ¢ Session å¯†é’¥
- [ ] æ£€æŸ¥ PM2 æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸
- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´
- [ ] æ›´æ–°ä¾èµ–åŒ…

### é‡åˆ°é—®é¢˜æ—¶

1. **å¯†ç æ— æ³•ç™»å½•**
   ```bash
   # æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡
   cat /proc/$(pm2 pid sillytavern-web)/environ | tr '\0' '\n' | grep ADMIN
   ```

2. **æœåŠ¡æ— æ³•å¯åŠ¨**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   pm2 logs sillytavern-web
   ```

3. **ä¿®æ”¹å¯†ç åä¸ç”Ÿæ•ˆ**
   ```bash
   # åˆ é™¤å¹¶é‡æ–°å¯åŠ¨ï¼ˆåŠ è½½æ–°é…ç½®ï¼‰
   pm2 delete sillytavern-web
   pm2 start ecosystem.config.js
   ```

---

## ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€

### æœåŠ¡ä¿¡æ¯
```
è¿›ç¨‹åç§°: sillytavern-web
è¿è¡ŒçŠ¶æ€: ğŸŸ¢ åœ¨çº¿
PID: $(pm2 pid sillytavern-web)
ç¯å¢ƒå˜é‡: âœ… ADMIN_PASSWORD å·²åŠ è½½
å¯†ç : hao123321
```

### é…ç½®æ–‡ä»¶ä½ç½®
```
PM2é…ç½®: /www/wwwroot/jiuguanmama/mySillyTavern/ecosystem.config.js
ç¯å¢ƒå˜é‡: /www/wwwroot/jiuguanmama/mySillyTavern/apps/web/.env.production.local
ä¸»é…ç½®: /www/wwwroot/jiuguanmama/mySillyTavern/.env
```

---

## âœ… ä¿®å¤éªŒè¯

### å·²ç¡®è®¤çš„äº‹é¡¹

- âœ… PM2 é…ç½®å·²æ›´æ–°
- âœ… ç¯å¢ƒå˜é‡æ–‡ä»¶å·²åˆ›å»º
- âœ… æœåŠ¡å·²é‡å¯
- âœ… ç¯å¢ƒå˜é‡å·²åŠ è½½åˆ°è¿›ç¨‹
- âœ… å¯†ç  `hao123321` å·²ç”Ÿæ•ˆ
- âœ… æ—§å¯†ç  `admin123` å·²å¤±æ•ˆ

---

## ğŸ‰ ä¿®å¤å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨å¯†ç  **`hao123321`** ç™»å½•ç®¡ç†ç³»ç»Ÿäº†ï¼

è®¿é—® ğŸ‘‰ `https://your-domain.com/admin/characters/login`

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-01 04:25  
**å½“å‰å¯ç”¨å¯†ç **: `hao123321` âœ…  
**æœåŠ¡çŠ¶æ€**: ğŸŸ¢ è¿è¡Œæ­£å¸¸  

