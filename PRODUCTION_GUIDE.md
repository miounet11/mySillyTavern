# SillyTavern 生产环境使用指南

## 🌐 生产环境信息

**主域名**: https://www.isillytavern.com/

**部署状态**: ✅ 已上线并运行
**最新版本**: 包含对话界面增强功能 (2025-10-28)

---

## 📍 主要页面访问

### 核心功能
| 页面 | 地址 | 描述 |
|------|------|------|
| 🏠 首页 | https://www.isillytavern.com/ | 平台介绍和快速开始 |
| 💬 **聊天界面** | https://www.isillytavern.com/chat | **新增强功能的核心页面** |
| 👤 角色卡管理 | https://www.isillytavern.com/characters | 创建和管理AI角色 |
| 🌍 社区角色卡 | https://www.isillytavern.com/characters/community | 浏览社区分享的角色 |
| 📚 世界书 | https://www.isillytavern.com/world-info | 管理世界设定 |
| ⚙️ 系统设置 | https://www.isillytavern.com/settings | AI模型配置和系统设置 |
| 📊 监控面板 | https://www.isillytavern.com/monitoring | 系统监控和日志 |

---

## 🎨 新功能：对话界面增强

### ✨ 核心改进

#### 1. **智能文本着色系统**

新的对话界面自动识别并美化不同类型的文本：

| 文本类型 | 语法 | 效果 | 颜色 |
|----------|------|------|------|
| 对话 | `"你好！"` | 粉色高亮 | #fda4af |
| 动作 | `*微笑*` | 紫色斜体 | #c4b5fd |
| 思考 | `(想着...)` | 蓝色斜体 | #93c5fd |
| 强调 | `**重要**` | 金色加粗 | #fbbf24 |
| 旁白 | 普通文本 | 默认色 | #f4e8c1 |

**手动标签支持：**
- `<talk>对话内容</talk>` → 粉色对话
- `<action>动作描述</action>` → 紫色动作
- `<think>内心想法</think>` → 蓝色思考
- `<em>强调内容</em>` → 金色强调

#### 2. **改进的消息布局**

- ✅ **更大的气泡**: 内边距从 20px 增加到 24px
- ✅ **更好的行距**: 行高从 1.625 提升到 1.75
- ✅ **更清晰的字体**: 字号从 14px 增加到 16px
- ✅ **更舒适的间距**: 消息间距从 16px 增加到 24px
- ✅ **微妙的深度**: 添加内阴影增强视觉层次

#### 3. **正则脚本系统**

强大的自定义文本处理系统，包含 12 个默认规则：

**预设规则：**
1. 删除状态栏标签 (TTL清理)
2. CG插图隐藏
3. 对话标签识别 (`<talk>`)
4. 动作标签识别 (`<action>`)
5. 思考标签识别 (`<think>`)
6. 强调标签识别 (`<em>`)
7. 自动识别对话（双引号）
8. 自动识别对话（中文引号）
9. 自动识别动作（星号）
10. 自动识别强调（双星号）
11. 自动识别思考（圆括号）
12. 行内代码格式化

---

## 🧪 功能测试指南

### 测试 1: 文本着色功能

**访问**: https://www.isillytavern.com/chat

1. 选择或创建一个角色
2. 发送以下测试消息：

```
"你好！很高兴见到你！" *热情地挥手* (心想：这个功能真棒) **欢迎使用新版本**
```

**预期结果：**
- `"你好！很高兴见到你！"` 显示为粉色
- `*热情地挥手*` 显示为紫色斜体
- `(心想：这个功能真棒)` 显示为蓝色斜体
- `**欢迎使用新版本**` 显示为金色加粗

### 测试 2: 手动标签

发送：
```
<talk>这是对话</talk>
<action>这是动作</action>
<think>这是思考</think>
<em>这是强调</em>
```

### 测试 3: 正则脚本编辑器

1. 进入聊天页面：https://www.isillytavern.com/chat
2. 点击顶部工具栏的 **"正则脚本"** 按钮 (code icon)
3. 查看所有默认规则
4. 尝试：
   - 启用/禁用特定规则
   - 调整规则优先级
   - 创建自定义规则
   - 导出/导入规则配置

### 测试 4: 混合内容

发送一段包含多种元素的消息：

```
他走进房间，"早上好！"他说道。*打开窗帘* 阳光洒进来，(今天天气真好)。**记得按时吃饭**。
```

所有不同类型的文本应该自动被识别并着色。

---

## 🎯 用户使用指南

### 对于普通用户

#### 自然输入
只需自然地输入，系统会自动识别：
- 用引号表示对话
- 用星号表示动作
- 用括号表示思考
- 用双星号表示强调

#### 精确控制
如果需要精确控制样式，使用标签：
```html
<talk>精确的对话</talk>
<action>精确的动作</action>
<think>精确的思考</think>
<em>精确的强调</em>
```

### 对于高级用户

#### 自定义正则规则

1. **打开编辑器**
   - 访问聊天页面
   - 点击 "正则脚本" 按钮

2. **创建新规则**
   - 点击 "添加脚本"
   - 填写规则名称
   - 输入正则表达式（查找）
   - 输入替换内容（可使用HTML）
   - 设置优先级（数字越大越优先）
   - 选择脚本类型（display/all）

3. **测试规则**
   - 使用内置测试功能验证规则
   - 输入测试文本
   - 查看输出结果

4. **分享规则**
   - 点击 "导出" 下载规则配置
   - 通过 "导入" 加载他人分享的规则

#### 规则优先级说明

- **1000+**: 清理规则（删除不需要的内容）
- **800-999**: 手动标签识别
- **400-799**: 自动文本识别
- **1-399**: 其他格式化

---

## 💡 最佳实践

### 内容创作建议

1. **对话为主**
   - 使用引号包裹所有对话
   - 保持对话自然流畅

2. **动作点缀**
   - 适度使用星号标记动作
   - 动作描述简洁生动

3. **思考补充**
   - 用括号表达内心想法
   - 增加角色深度

4. **强调重点**
   - 双星号标记关键信息
   - 不要过度使用

### 性能优化

1. **规则数量**: 建议保持在 20 个以内
2. **正则复杂度**: 避免过于复杂的正则表达式
3. **优先级设置**: 合理设置避免冲突
4. **定期清理**: 删除不再使用的规则

---

## 🔧 故障排除

### 问题：文本没有被着色

**解决方案：**
1. 检查正则脚本是否已启用
2. 打开 "正则脚本编辑器" 确认规则状态
3. 尝试点击 "加载默认规则" 重置
4. 清除浏览器缓存并刷新页面

### 问题：样式显示不正确

**解决方案：**
1. 确认使用的是最新版本
2. 按 `Ctrl+F5` (Windows) 或 `Cmd+Shift+R` (Mac) 强制刷新
3. 检查浏览器控制台是否有错误

### 问题：规则冲突

**解决方案：**
1. 调整规则优先级
2. 高优先级规则先执行
3. 禁用冲突的规则
4. 优化正则表达式避免重叠匹配

---

## 📊 技术信息

### 系统架构

```
用户输入
    ↓
LocalStorage (读取规则)
    ↓
优先级排序
    ↓
依次应用正则规则
    ↓
HTML渲染
    ↓
显示着色文本
```

### 数据存储

- **位置**: 浏览器 localStorage
- **键名**: `regex_scripts`
- **格式**: JSON数组
- **持久化**: 跨会话保持

### 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

---

## 📞 支持与反馈

### 获取帮助

- **官网**: https://www.isillytavern.com/
- **文档**: `/CHAT_ENHANCEMENT_IMPLEMENTATION.md`
- **技术文档**: `/chat-interface.plan.md`

### 报告问题

如发现问题，请提供：
1. 浏览器类型和版本
2. 问题截图
3. 控制台错误信息
4. 重现步骤

---

## 🎉 更新日志

### v1.1.0 (2025-10-28)

**新增功能：**
- ✅ 智能文本着色系统
- ✅ 12 个默认正则规则
- ✅ 可视化正则脚本编辑器
- ✅ 规则导入/导出功能
- ✅ 实时测试工具

**界面优化：**
- ✅ 增大消息气泡 (24px 内边距)
- ✅ 提升行高 (1.75)
- ✅ 增大字号 (16px)
- ✅ 扩大消息间距 (24px)
- ✅ 添加内阴影效果

**技术改进：**
- ✅ LocalStorage 持久化
- ✅ 优先级排序系统
- ✅ 正则表达式验证
- ✅ 错误处理机制

---

## 🚀 快速开始

1. **访问聊天页面**: https://www.isillytavern.com/chat
2. **选择角色**: 从角色列表选择或创建新角色
3. **开始对话**: 自然输入，体验智能着色
4. **自定义规则**: 点击 "正则脚本" 按钮自定义

**首次使用提示：**
- 系统会自动加载默认规则
- 所有设置保存在本地浏览器
- 可随时重置为默认配置

---

**文档版本**: v1.0  
**更新日期**: 2025-10-28  
**生产环境**: https://www.isillytavern.com/

