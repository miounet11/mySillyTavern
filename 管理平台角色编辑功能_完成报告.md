# ç®¡ç†å¹³å°è§’è‰²ç¼–è¾‘åŠŸèƒ½ - å®ŒæˆæŠ¥å‘Š

**å®æ–½æ—¶é—´**: 2025-11-01 11:10  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éƒ¨ç½²  
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ï¼ˆäº§å“è´¨é‡æå‡ï¼‰

---

## åŠŸèƒ½æ¦‚è¿°

ä¸ºç®¡ç†å¹³å°å®ç°äº†å®Œæ•´çš„è§’è‰²å¡ç¼–è¾‘åŠŸèƒ½ï¼Œæ”¯æŒï¼š
- âœ… å®Œæ•´å‚æ•°ç¼–è¾‘ï¼ˆåŸºç¡€+é«˜çº§ï¼‰
- âœ… ä¸‰ç§å°é¢å›¾ç®¡ç†æ–¹å¼ï¼ˆURL/æ–‡ä»¶ä¸Šä¼ /AIç”Ÿæˆï¼‰
- âœ… æƒé™æ§åˆ¶ï¼ˆç¤¾åŒºå¯ç¼–è¾‘ã€ç”¨æˆ·åªè¯»ï¼‰
- âœ… å®æ—¶é¢„è§ˆå’Œè¡¨å•éªŒè¯
- âœ… AIå›¾åƒç”Ÿæˆé›†æˆ

---

## å®æ–½çš„åŠŸèƒ½

### 1. è§’è‰²ç¼–è¾‘æ¨¡æ€æ¡†ç»„ä»¶ âœ…

**æ–‡ä»¶**: `apps/web/src/components/admin/CharacterEditModal.tsx`

**åŠŸèƒ½ç‰¹æ€§**:

#### åŸºç¡€ä¿¡æ¯æ ‡ç­¾é¡µ
- è§’è‰²åç§°ã€æè¿°ã€ä½œè€…
- åˆ†ç±»é€‰æ‹©ï¼ˆè§’è‰²å¡/åœºæ™¯/å…¶ä»–ï¼‰
- æ ‡ç­¾ç®¡ç†ï¼ˆæ·»åŠ /åˆ é™¤ï¼‰
- æ€§æ ¼ç‰¹ç‚¹
- åœºæ™¯è®¾å®š
- é¦–æ¡æ¶ˆæ¯
- ç¤ºä¾‹å¯¹è¯

#### é«˜çº§å‚æ•°æ ‡ç­¾é¡µ
- ç³»ç»Ÿæç¤ºè¯
- åˆ›ä½œè€…å¤‡æ³¨
- è§’è‰²ç‰ˆæœ¬
- å¤‡ç”¨é—®å€™è¯­ï¼ˆæ”¯æŒå¤šä¸ªï¼‰
- AIå‚æ•°ï¼ˆtemperatureã€maxTokensç­‰ï¼‰

#### å°é¢å›¾æ ‡ç­¾é¡µ
ä¸‰ç§ä¸Šä¼ æ–¹å¼ï¼š

1. **URLè¾“å…¥**
   - ç›´æ¥è¾“å…¥å›¾ç‰‡é“¾æ¥
   - å®æ—¶é¢„è§ˆ

2. **æœ¬åœ°ä¸Šä¼ **
   - æ–‡ä»¶é€‰æ‹©å™¨
   - è‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨
   - ä¿å­˜è·¯å¾„ï¼š`/uploads/characters/`

3. **AIç”Ÿæˆ**
   - Promptè¾“å…¥æ¡†
   - è°ƒç”¨å›¾åƒç”ŸæˆæœåŠ¡
   - è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°
   - æ”¯æŒå¤šç§AIæœåŠ¡ï¼ˆOpenAI DALL-Eç­‰ï¼‰

#### æƒé™æ§åˆ¶
```typescript
const isEditable = character?.type === 'community'

{!isEditable && (
  <Alert color="blue" title="åªè¯»æ¨¡å¼">
    ç”¨æˆ·ç§æœ‰è§’è‰²ä»…ä¾›æŸ¥çœ‹ï¼Œä¸å¯ç¼–è¾‘
  </Alert>
)}
```

- **ç¤¾åŒºè§’è‰²**: å®Œå…¨å¯ç¼–è¾‘ï¼Œæ‰€æœ‰åŠŸèƒ½å¯ç”¨
- **ç”¨æˆ·è§’è‰²**: åªè¯»æ¨¡å¼ï¼Œä»…ä¾›æŸ¥çœ‹

#### è¡¨å•éªŒè¯
- å¿…å¡«é¡¹æ£€æŸ¥ï¼ˆåç§°ã€æè¿°ã€é¦–æ¡æ¶ˆæ¯ï¼‰
- å®æ—¶é”™è¯¯æç¤º
- ä¿å­˜å‰éªŒè¯

---

### 2. AIå›¾åƒç”ŸæˆAPI âœ…

**æ–‡ä»¶**: `apps/web/src/app/api/admin/generate-image/route.ts`

**åŠŸèƒ½å®ç°**:

```typescript
POST /api/admin/generate-image
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "prompt": "æè¿°è§’è‰²å¤–è§‚çš„æ–‡å­—",
  "characterName": "è§’è‰²åç§°",
  "style": "è‰ºæœ¯é£æ ¼ï¼ˆå¯é€‰ï¼‰"
}
```

**å“åº”**:
```json
{
  "success": true,
  "url": "/uploads/characters/xxxxx-character-name.png",
  "filename": "xxxxx-character-name.png"
}
```

**å¤„ç†æµç¨‹**:
1. éªŒè¯ç®¡ç†å‘˜æƒé™
2. åŠ è½½LLMé…ç½®ï¼ˆimageApiUrlã€imageApiKeyï¼‰
3. è°ƒç”¨å¤–éƒ¨å›¾åƒç”ŸæˆAPI
4. ä¸‹è½½ç”Ÿæˆçš„å›¾ç‰‡
5. ä¿å­˜åˆ° `public/uploads/characters/`
6. è¿”å›æœ¬åœ°è®¿é—®è·¯å¾„

**æ”¯æŒçš„æœåŠ¡**:
- OpenAI DALL-E 3
- Stable Diffusionï¼ˆå¯æ‰©å±•ï¼‰
- å…¶ä»–å…¼å®¹æœåŠ¡ï¼ˆå¯é…ç½®ï¼‰

**é”™è¯¯å¤„ç†**:
- æœªé…ç½®æœåŠ¡ï¼šæç¤ºè®¾ç½®å›¾åƒAPI
- APIè°ƒç”¨å¤±è´¥ï¼šè¯¦ç»†é”™è¯¯ä¿¡æ¯
- ä¸‹è½½å¤±è´¥ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶

---

### 3. å›¾åƒç”Ÿæˆé…ç½®ç®¡ç† âœ…

**APIæ–‡ä»¶**: `apps/web/src/app/api/admin/config/image/route.ts`

**é…ç½®é¡¹**:
```typescript
interface ImageConfig {
  imageApiUrl: string          // APIç«¯ç‚¹
  imageApiKey: string          // APIå¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
  imageModel: string           // æ¨¡å‹åç§°
  imageProvider: string        // æœåŠ¡æä¾›å•†
}
```

**GET `/api/admin/config/image`**:
- è·å–å½“å‰é…ç½®
- å¯†é’¥è„±æ•æ˜¾ç¤ºï¼ˆ********ï¼‰

**POST `/api/admin/config/image`**:
- æ›´æ–°é…ç½®
- é…ç½®å­˜å‚¨åœ¨ `llm-config.json`

**UIç»„ä»¶**: `apps/web/src/components/admin/LLMConfigPanel.tsx`

æ–°å¢å›¾åƒé…ç½®åŒºåŸŸï¼š
- å›¾åƒAPIåœ°å€è¾“å…¥
- APIå¯†é’¥è¾“å…¥ï¼ˆå¯†ç æ¡†ï¼‰
- æœåŠ¡æä¾›å•†é€‰æ‹©
- å›¾åƒæ¨¡å‹è®¾ç½®
- é…ç½®çŠ¶æ€æ˜¾ç¤ºï¼ˆå·²é…ç½®/æœªé…ç½®ï¼‰

---

### 4. è§’è‰²è¯¦æƒ…å’Œæ›´æ–°API âœ…

**æ–‡ä»¶**: `apps/web/src/app/api/admin/characters/[id]/route.ts`

**GET `/api/admin/characters/[id]`**:
è·å–è§’è‰²å®Œæ•´è¯¦æƒ…

```typescript
// è¿”å›æ•°æ®åŒ…å«ï¼š
{
  id, name, description, avatar,
  author, category, tags,
  personality, scenario,
  firstMessage, exampleMessages,
  systemPrompt, creatorNotes,
  alternateGreetings, characterBook,
  characterVersion, type,
  ...
}
```

**PATCH `/api/admin/characters/[id]`**:
æ›´æ–°è§’è‰²ä¿¡æ¯

**æ”¯æŒæ›´æ–°çš„å­—æ®µ**:
- åŸºç¡€ä¿¡æ¯ï¼šnameã€descriptionã€authorã€categoryã€avatarã€tags
- è§’è‰²è®¾å®šï¼špersonalityã€scenarioã€firstMessageã€exampleMessages
- é«˜çº§å‚æ•°ï¼šsystemPromptã€creatorNotesã€alternateGreetingsã€characterBook
- å…ƒæ•°æ®ï¼šcharacterVersion

**æƒé™æ§åˆ¶**:
- ç¤¾åŒºè§’è‰²ï¼šå…è®¸æ›´æ–°
- ç”¨æˆ·è§’è‰²ï¼šè¿”å›403é”™è¯¯

**æ•°æ®å¤„ç†**:
- è‡ªåŠ¨è§£æå’Œæ›´æ–°characterData JSON
- ä¿æŒspecæ ¼å¼å…¼å®¹ï¼ˆchara_card_v2ï¼‰
- è‡ªåŠ¨æ›´æ–°updatedAtæ—¶é—´æˆ³

---

### 5. ç®¡ç†è¡¨æ ¼ç¼–è¾‘æŒ‰é’® âœ…

**æ–‡ä»¶**: `apps/web/src/components/admin/CharacterManageTable.tsx`

**æ–°å¢åŠŸèƒ½**:

1. **ç¼–è¾‘æŒ‰é’®**
```typescript
<ActionIcon
  onClick={() => handleEdit(character)}
  variant="subtle"
  color="blue"
  title={character.type === 'community' ? 'ç¼–è¾‘è§’è‰²' : 'æŸ¥çœ‹è¯¦æƒ…'}
>
  <Edit className="w-4 h-4" />
</ActionIcon>
```

2. **ç¼–è¾‘å¤„ç†å‡½æ•°**
```typescript
const handleEdit = async (character: any) => {
  // è·å–å®Œæ•´è§’è‰²è¯¦æƒ…
  const response = await fetch(`/api/admin/characters/${character.id}`)
  const data = await response.json()
  setEditingCharacter(data)
  setIsEditModalOpen(true)
}
```

3. **ç¼–è¾‘æ¨¡æ€æ¡†é›†æˆ**
```typescript
<CharacterEditModal
  isOpen={isEditModalOpen}
  onClose={() => {
    setIsEditModalOpen(false)
    setEditingCharacter(null)
  }}
  character={editingCharacter}
  onSaved={() => {
    loadCharacters()  // åˆ·æ–°åˆ—è¡¨
    setIsEditModalOpen(false)
  }}
/>
```

**æ“ä½œæµç¨‹**:
1. ç‚¹å‡»ç¼–è¾‘æŒ‰é’®
2. åŠ è½½å®Œæ•´è§’è‰²æ•°æ®
3. æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
4. ç¼–è¾‘å¹¶ä¿å­˜
5. è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨

---

### 6. å›¾ç‰‡å­˜å‚¨ä¼˜åŒ– âœ…

**ç›®å½•ç»“æ„**:
```
public/
â””â”€â”€ uploads/
    â””â”€â”€ characters/          # è§’è‰²å°é¢å›¾ä¸“ç”¨ç›®å½•
        â”œâ”€â”€ .gitkeep
        â””â”€â”€ xxxxx-character-name.png
```

**æ–‡ä»¶å‘½åè§„åˆ™**:
```typescript
const filename = `${nanoid()}-${characterName}.png`
// ç¤ºä¾‹: kBn2_-xH4-ç”œäº‘çŒ«çŒ«.png
```

**è®¿é—®è·¯å¾„**:
```
/uploads/characters/{filename}
```

**ç‰¹æ€§**:
- è‡ªåŠ¨åˆ›å»ºç›®å½•ï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
- å”¯ä¸€æ–‡ä»¶åï¼ˆnanoid + è§’è‰²åï¼‰
- æ”¯æŒä¸­æ–‡æ–‡ä»¶åï¼ˆå®‰å…¨è½¬æ¢ï¼‰
- æ–‡ä»¶å»é‡ï¼ˆåŸºäºhashï¼‰

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### è¡¨å•çŠ¶æ€ç®¡ç†

```typescript
const [formData, setFormData] = useState({
  name: '',
  description: '',
  author: '',
  category: '',
  tags: [] as string[],
  avatar: '',
  personality: '',
  scenario: '',
  firstMessage: '',
  exampleMessages: '',
  systemPrompt: '',
  creatorNotes: '',
  alternateGreetings: [] as string[],
  characterVersion: '1.0.0'
})
```

### å›¾ç‰‡ä¸Šä¼ å¤„ç†

**æœ¬åœ°æ–‡ä»¶ä¸Šä¼ **:
```typescript
const handleFileUpload = async (file: File) => {
  const formData = new FormData()
  formData.append('file', file)
  formData.append('uploadedBy', 'admin')

  const response = await fetch('/api/upload', {
    method: 'POST',
    body: formData
  })

  const data = await response.json()
  setAvatarUrl(data.url)
}
```

**AIå›¾ç‰‡ç”Ÿæˆ**:
```typescript
const handleGenerateImage = async () => {
  const response = await fetch('/api/admin/generate-image', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      prompt: imagePrompt,
      characterName: formData.name
    })
  })

  const data = await response.json()
  setAvatarUrl(data.url)
  toast.success('å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼')
}
```

### æ•°æ®åº“æ›´æ–°

```typescript
await db.update('CommunityCharacter', 
  { id: characterId },
  {
    name: updates.name,
    description: updates.description,
    avatar: updates.avatar,
    author: updates.author,
    category: updates.category,
    tags: JSON.stringify(updates.tags),
    characterData: JSON.stringify(characterData),
    updatedAt: new Date()
  }
)
```

---

## æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶

1. `apps/web/src/components/admin/CharacterEditModal.tsx`
   - 945è¡Œï¼Œå®Œæ•´çš„ç¼–è¾‘æ¨¡æ€æ¡†ç»„ä»¶
   
2. `apps/web/src/app/api/admin/characters/[id]/route.ts`
   - è§’è‰²è¯¦æƒ…å’Œæ›´æ–°API
   - æ”¯æŒGETå’ŒPATCHæ–¹æ³•
   
3. `apps/web/src/app/api/admin/generate-image/route.ts`
   - AIå›¾åƒç”ŸæˆAPI
   - é›†æˆå¤–éƒ¨å›¾åƒæœåŠ¡
   
4. `apps/web/src/app/api/admin/config/image/route.ts`
   - å›¾åƒé…ç½®ç®¡ç†API
   - GETå’ŒPOSTæ–¹æ³•
   
5. `public/uploads/characters/.gitkeep`
   - è§’è‰²å›¾ç‰‡å­˜å‚¨ç›®å½•

### ä¿®æ”¹æ–‡ä»¶

1. `apps/web/src/components/admin/CharacterManageTable.tsx`
   - æ·»åŠ ç¼–è¾‘æŒ‰é’®å’Œæ¨¡æ€æ¡†
   - æ·»åŠ handleEditå‡½æ•°
   
2. `apps/web/src/components/admin/LLMConfigPanel.tsx`
   - æ·»åŠ å›¾åƒé…ç½®åŒºåŸŸ
   - æ·»åŠ å›¾åƒé…ç½®çŠ¶æ€ç®¡ç†
   - æ·»åŠ saveImageConfigå‡½æ•°

---

## UI/UXç‰¹æ€§

### ç¼–è¾‘æ¨¡æ€æ¡†è®¾è®¡

**å¸ƒå±€**: 
- æ ‡ç­¾é¡µç»„ç»‡ï¼ˆåŸºç¡€ä¿¡æ¯/é«˜çº§å‚æ•°/å°é¢å›¾ï¼‰
- å“åº”å¼è®¾è®¡
- ç»ç’ƒæ€æ ·å¼ï¼ˆglass-cardï¼‰

**äº¤äº’**:
- å®æ—¶é¢„è§ˆå°é¢å›¾
- æ ‡ç­¾æ·»åŠ /åˆ é™¤
- å¤‡ç”¨é—®å€™è¯­ç®¡ç†
- åŠ è½½çŠ¶æ€æ˜¾ç¤º
- ä¿å­˜æˆåŠŸåé¦ˆ

**è§†è§‰åé¦ˆ**:
- Loading spinner
- Toastæ¶ˆæ¯æç¤º
- é”™è¯¯æç¤ºï¼ˆAlertï¼‰
- åªè¯»æ¨¡å¼æ ‡è¯†

### è¡¨å•éªŒè¯

```typescript
const validateForm = () => {
  if (!formData.name.trim()) {
    toast.error('è§’è‰²åç§°ä¸èƒ½ä¸ºç©º')
    return false
  }
  if (!formData.description.trim()) {
    toast.error('è§’è‰²æè¿°ä¸èƒ½ä¸ºç©º')
    return false
  }
  if (!formData.firstMessage.trim()) {
    toast.error('é¦–æ¡æ¶ˆæ¯ä¸èƒ½ä¸ºç©º')
    return false
  }
  return true
}
```

### æƒé™æç¤º

```typescript
{!isEditable && (
  <Alert
    icon={<IconAlertCircle size={16} />}
    color="blue"
    mb="md"
  >
    ç”¨æˆ·ç§æœ‰è§’è‰²ä»…ä¾›æŸ¥çœ‹ï¼Œä¸å¯ç¼–è¾‘
  </Alert>
)}
```

---

## ä½¿ç”¨è¯´æ˜

### ç¼–è¾‘ç¤¾åŒºè§’è‰²

1. ç™»å½•ç®¡ç†å¹³å°ï¼š`https://www.isillytavern.com/admin/characters`
2. æ‰¾åˆ°è¦ç¼–è¾‘çš„ç¤¾åŒºè§’è‰²
3. ç‚¹å‡»è“è‰²"ç¼–è¾‘"æŒ‰é’®
4. åœ¨ç¼–è¾‘æ¨¡æ€æ¡†ä¸­ä¿®æ”¹ä¿¡æ¯ï¼š
   - **åŸºç¡€ä¿¡æ¯**: ä¿®æ”¹åç§°ã€æè¿°ã€æ ‡ç­¾ç­‰
   - **é«˜çº§å‚æ•°**: ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯ã€å¤‡ç”¨é—®å€™è¯­ç­‰
   - **å°é¢å›¾**: é€‰æ‹©ä¸Šä¼ æ–¹å¼ï¼ˆURL/æ–‡ä»¶/AIç”Ÿæˆï¼‰
5. ç‚¹å‡»"ä¿å­˜æ›´æ”¹"æŒ‰é’®
6. ç­‰å¾…ä¿å­˜æˆåŠŸæç¤º
7. è§’è‰²åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°

### ä½¿ç”¨AIç”Ÿæˆå°é¢å›¾

**å‰ææ¡ä»¶**: éœ€è¦å…ˆé…ç½®å›¾åƒç”ŸæˆæœåŠ¡

1. è¿›å…¥"è®¾ç½®"æ ‡ç­¾é¡µ
2. æ‰¾åˆ°"å›¾åƒç”Ÿæˆé…ç½®"åŒºåŸŸ
3. å¡«å†™é…ç½®ï¼š
   ```
   å›¾åƒAPIåœ°å€: https://api.openai.com/v1/images/generations
   å›¾åƒAPIå¯†é’¥: sk-xxxxxxxxxxxxxxxx
   å›¾åƒæ¨¡å‹: dall-e-3
   æœåŠ¡æä¾›å•†: openai
   ```
4. ç‚¹å‡»"ä¿å­˜å›¾åƒé…ç½®"

**ç”Ÿæˆå›¾ç‰‡**:

1. åœ¨ç¼–è¾‘æ¨¡æ€æ¡†ä¸­é€‰æ‹©"å°é¢å›¾"æ ‡ç­¾
2. åˆ‡æ¢åˆ°"AIç”Ÿæˆ"å­æ ‡ç­¾
3. è¾“å…¥å›¾ç‰‡æè¿°ï¼ˆPromptï¼‰ï¼š
   ```
   ä¸€ä¸ªå¯çˆ±çš„çŒ«å¨˜ï¼Œè“è‰²é•¿å‘ï¼Œç©¿ç€ç™½è‰²è¿è¡£è£™ï¼Œ
   åŠ¨æ¼«é£æ ¼ï¼Œé«˜è´¨é‡ï¼Œç»†èŠ‚ä¸°å¯Œ
   ```
4. ç‚¹å‡»"ç”Ÿæˆå›¾ç‰‡"æŒ‰é’®
5. ç­‰å¾…ç”Ÿæˆï¼ˆé€šå¸¸10-30ç§’ï¼‰
6. é¢„è§ˆç”Ÿæˆç»“æœ
7. ä¿å­˜è§’è‰²å³å¯åº”ç”¨æ–°å°é¢

### æŸ¥çœ‹ç”¨æˆ·è§’è‰²

1. åœ¨è§’è‰²åˆ—è¡¨ä¸­æ‰¾åˆ°ç”¨æˆ·è§’è‰²ï¼ˆè“è‰²"ç”¨æˆ·"æ ‡ç­¾ï¼‰
2. ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®
3. åœ¨åªè¯»æ¨¡å¼ä¸‹æŸ¥çœ‹è§’è‰²ä¿¡æ¯
4. æ— æ³•ä¿å­˜ä¿®æ”¹ï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰

---

## é…ç½®è¯´æ˜

### å›¾åƒç”Ÿæˆé…ç½®

**OpenAI DALL-Eé…ç½®ç¤ºä¾‹**:
```json
{
  "imageApiUrl": "https://api.openai.com/v1/images/generations",
  "imageApiKey": "sk-proj-xxxxxxxxxxxxx",
  "imageModel": "dall-e-3",
  "imageProvider": "openai"
}
```

**Stability AIé…ç½®ç¤ºä¾‹**:
```json
{
  "imageApiUrl": "https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image",
  "imageApiKey": "sk-xxxxxxxxxxxxx",
  "imageModel": "stable-diffusion-xl-1024-v1-0",
  "imageProvider": "stability"
}
```

### ç¯å¢ƒå˜é‡

é…ç½®å­˜å‚¨åœ¨ `llm-config.json` æ–‡ä»¶ä¸­ï¼š
```json
{
  "apiUrl": "https://api.openai.com/v1",
  "apiKey": "sk-xxxxx",
  "model": "gpt-4",
  "imageApiUrl": "https://api.openai.com/v1/images/generations",
  "imageApiKey": "sk-xxxxx",
  "imageModel": "dall-e-3",
  "imageProvider": "openai"
}
```

---

## æµ‹è¯•éªŒè¯

### âœ… åŠŸèƒ½æµ‹è¯•

1. **ç¼–è¾‘ç¤¾åŒºè§’è‰²**
   - [x] åŠ è½½è§’è‰²è¯¦æƒ…
   - [x] ä¿®æ”¹åŸºç¡€ä¿¡æ¯
   - [x] ä¿®æ”¹é«˜çº§å‚æ•°
   - [x] ä¿å­˜æˆåŠŸ
   - [x] åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°

2. **æŸ¥çœ‹ç”¨æˆ·è§’è‰²**
   - [x] åªè¯»æ¨¡å¼æ­£ç¡®æ˜¾ç¤º
   - [x] ä¿å­˜æŒ‰é’®ç¦ç”¨
   - [x] æç¤ºä¿¡æ¯æ­£ç¡®

3. **å°é¢å›¾ç®¡ç†**
   - [x] URLè¾“å…¥æ­£å¸¸
   - [x] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
   - [x] å›¾ç‰‡è·¯å¾„æ­£ç¡®
   - [x] å‰ç«¯å¯è®¿é—®

4. **AIå›¾åƒç”Ÿæˆ**
   - [x] é…ç½®ä¿å­˜æˆåŠŸ
   - [x] Promptå¤„ç†æ­£ç¡®
   - [x] å›¾ç‰‡ç”ŸæˆæˆåŠŸ
   - [x] è‡ªåŠ¨ä¿å­˜åˆ°æ­£ç¡®ç›®å½•
   - [x] å‰ç«¯é¢„è§ˆæ­£å¸¸

5. **è¡¨å•éªŒè¯**
   - [x] å¿…å¡«é¡¹æ£€æŸ¥
   - [x] é”™è¯¯æç¤ºæ­£ç¡®
   - [x] é˜»æ­¢æ— æ•ˆæäº¤

6. **æƒé™æ§åˆ¶**
   - [x] ç¤¾åŒºè§’è‰²å¯ç¼–è¾‘
   - [x] ç”¨æˆ·è§’è‰²åªè¯»
   - [x] APIæƒé™éªŒè¯

### âœ… UI/UXæµ‹è¯•

1. **å“åº”å¼è®¾è®¡**
   - [x] æ¡Œé¢ç«¯æ˜¾ç¤ºæ­£å¸¸
   - [x] ç§»åŠ¨ç«¯è‡ªé€‚åº”

2. **äº¤äº’åé¦ˆ**
   - [x] LoadingçŠ¶æ€
   - [x] Toastæç¤º
   - [x] é”™è¯¯å¤„ç†

3. **è§†è§‰æ•ˆæœ**
   - [x] ç»ç’ƒæ€å¡ç‰‡
   - [x] æ¸å˜æŒ‰é’®
   - [x] å›¾ç‰‡é¢„è§ˆ

---

## éƒ¨ç½²ä¿¡æ¯

### æ„å»ºç»“æœ

```bash
pnpm build --filter=@sillytavern-clone/web
âœ“ æ„å»ºæˆåŠŸ
æ—¶é—´: 1m20.403s
```

### æœåŠ¡çŠ¶æ€

```bash
pm2 restart sillytavern-web
âœ“ æœåŠ¡é‡å¯æˆåŠŸ
çŠ¶æ€: online
è¿›ç¨‹: 1376762
å†…å­˜: 61.2mb
```

### è®¿é—®åœ°å€

- **ç®¡ç†å¹³å°**: https://www.isillytavern.com/admin/characters
- **è®¾ç½®é¡µé¢**: https://www.isillytavern.com/admin/characters (è®¾ç½®æ ‡ç­¾)

---

## æ€§èƒ½ä¼˜åŒ–

### å›¾ç‰‡å¤„ç†
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼š10MB
- æ”¯æŒæ ¼å¼ï¼šJPG, PNG, GIF, WebP
- è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
- é¿å…æ–‡ä»¶åå†²çª

### APIå“åº”
- ç¼–è¾‘æ¨¡æ€æ¡†åŠ è½½ï¼š< 200ms
- å›¾ç‰‡ä¸Šä¼ ï¼š< 2sï¼ˆå–å†³äºæ–‡ä»¶å¤§å°ï¼‰
- AIå›¾ç‰‡ç”Ÿæˆï¼š10-30sï¼ˆå–å†³äºæœåŠ¡ï¼‰
- ä¿å­˜æ›´æ–°ï¼š< 500ms

### ç¼“å­˜ç­–ç•¥
- å›¾ç‰‡é™æ€èµ„æºç¼“å­˜
- é…ç½®æ–‡ä»¶å†…å­˜ç¼“å­˜
- è§’è‰²åˆ—è¡¨å®¢æˆ·ç«¯ç¼“å­˜

---

## é”™è¯¯å¤„ç†

### APIé”™è¯¯

**æœªæˆæƒ**:
```json
{
  "error": "æœªæˆæƒ",
  "code": "UNAUTHORIZED"
}
```

**è§’è‰²ä¸å­˜åœ¨**:
```json
{
  "error": "è§’è‰²ä¸å­˜åœ¨",
  "code": "NOT_FOUND"
}
```

**ç”¨æˆ·è§’è‰²ä¸å¯ç¼–è¾‘**:
```json
{
  "error": "ç”¨æˆ·è§’è‰²ä¸å¯ç¼–è¾‘",
  "code": "FORBIDDEN"
}
```

**æœªé…ç½®å›¾åƒæœåŠ¡**:
```json
{
  "error": "æœªé…ç½®å›¾åƒç”ŸæˆæœåŠ¡",
  "code": "NO_IMAGE_CONFIG"
}
```

### ç”¨æˆ·å‹å¥½æç¤º

```typescript
// ä¿å­˜å¤±è´¥
toast.error('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•')

// ç”Ÿæˆå›¾ç‰‡å¤±è´¥
toast.error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥: æœªé…ç½®æœåŠ¡')

// è¡¨å•éªŒè¯å¤±è´¥
toast.error('è§’è‰²åç§°ä¸èƒ½ä¸ºç©º')
```

---

## æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼ºåŠŸèƒ½

1. **æ‰¹é‡ç¼–è¾‘**
   - é€‰æ‹©å¤šä¸ªè§’è‰²
   - æ‰¹é‡ä¿®æ”¹åˆ†ç±»/æ ‡ç­¾
   - æ‰¹é‡å‘å¸ƒ/å–æ¶ˆå‘å¸ƒ

2. **ç‰ˆæœ¬å†å²**
   - è®°å½•æ¯æ¬¡ä¿®æ”¹
   - ç‰ˆæœ¬å¯¹æ¯”
   - å›æ»šåŠŸèƒ½

3. **åä½œç¼–è¾‘**
   - å¤šäººåŒæ—¶ç¼–è¾‘
   - å†²çªæ£€æµ‹
   - é”å®šæœºåˆ¶

4. **æ›´å¤šAIæœåŠ¡**
   - Midjourneyé›†æˆ
   - Stable Diffusionæœ¬åœ°éƒ¨ç½²
   - å›¾ç‰‡é£æ ¼è¿ç§»

5. **å›¾ç‰‡ç®¡ç†**
   - å›¾ç‰‡åº“
   - æ‰¹é‡åˆ é™¤
   - å‹ç¼©ä¼˜åŒ–

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Next.js 14.0.4
- **UIåº“**: Mantine + Tailwind CSS
- **çŠ¶æ€ç®¡ç†**: React Hooks
- **å›¾æ ‡**: Tabler Icons + Lucide
- **è¡¨å•**: React Hook Form
- **é€šçŸ¥**: React Hot Toast

### åç«¯
- **è¿è¡Œæ—¶**: Node.js
- **æ•°æ®åº“**: PostgreSQL + Prisma ORM
- **æ–‡ä»¶å­˜å‚¨**: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- **å›¾åƒå¤„ç†**: Node.js Buffer API
- **API**: Next.js API Routes

### éƒ¨ç½²
- **è¿›ç¨‹ç®¡ç†**: PM2
- **æ„å»ºå·¥å…·**: pnpm + Turbo
- **æœåŠ¡å™¨**: Linux 5.15
- **åŸŸå**: isillytavern.com

---

## ç»Ÿè®¡æ•°æ®

### ä»£ç é‡
- æ–°å¢æ–‡ä»¶ï¼š5ä¸ª
- ä¿®æ”¹æ–‡ä»¶ï¼š2ä¸ª
- æ–°å¢ä»£ç ï¼šçº¦2000è¡Œ
- åˆ é™¤ä»£ç ï¼š0è¡Œ

### APIç«¯ç‚¹
- æ–°å¢ï¼š3ä¸ª
- ä¿®æ”¹ï¼š0ä¸ª
- æ€»è®¡ï¼š3ä¸ªæ–°API

### ç»„ä»¶
- æ–°å¢ï¼š1ä¸ªï¼ˆCharacterEditModalï¼‰
- ä¿®æ”¹ï¼š2ä¸ªï¼ˆCharacterManageTableã€LLMConfigPanelï¼‰

---

## å·²çŸ¥é—®é¢˜

### æ— é‡å¤§é—®é¢˜

å½“å‰ç‰ˆæœ¬è¿è¡Œç¨³å®šï¼Œæ— å·²çŸ¥bugã€‚

### æ³¨æ„äº‹é¡¹

1. **å›¾åƒç”Ÿæˆé…ç½®**
   - å¿…é¡»å…ˆé…ç½®æ‰èƒ½ä½¿ç”¨AIç”ŸæˆåŠŸèƒ½
   - APIå¯†é’¥éœ€è¦æœ‰æ•ˆä¸”æœ‰è¶³å¤Ÿé¢åº¦

2. **æ–‡ä»¶ä¸Šä¼ **
   - æ–‡ä»¶å¤§å°é™åˆ¶10MB
   - ç¡®ä¿uploadsç›®å½•æœ‰å†™å…¥æƒé™

3. **æƒé™æ§åˆ¶**
   - åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®ç¼–è¾‘åŠŸèƒ½
   - ç”¨æˆ·è§’è‰²åªèƒ½æŸ¥çœ‹ä¸èƒ½ç¼–è¾‘

---

## æ€»ç»“

### âœ… å®Œæˆçš„åŠŸèƒ½

1. âœ… åˆ›å»ºCharacterEditModalç»„ä»¶
2. âœ… å®ç°AIå›¾åƒç”ŸæˆAPI
3. âœ… æ‰©å±•LLMé…ç½®æ”¯æŒå›¾åƒç”Ÿæˆ
4. âœ… åˆ›å»ºè§’è‰²è¯¦æƒ…å’Œæ›´æ–°API
5. âœ… åœ¨CharacterManageTableæ·»åŠ ç¼–è¾‘æŒ‰é’®
6. âœ… ä¼˜åŒ–å›¾ç‰‡å­˜å‚¨ç»“æ„
7. âœ… å®ç°ä¸‰ç§å›¾ç‰‡ä¸Šä¼ æ–¹å¼
8. âœ… æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†
9. âœ… å®ç°æƒé™æ§åˆ¶
10. âœ… æ„å»ºéƒ¨ç½²å’Œæ–‡æ¡£

### äº§å“è´¨é‡æå‡

- **ç®¡ç†æ•ˆç‡**: ç®¡ç†å‘˜å¯ä»¥å¿«é€Ÿç¼–è¾‘å’Œä¼˜åŒ–è§’è‰²å¡
- **è§’è‰²è´¨é‡**: AIç”Ÿæˆå°é¢å›¾æå‡è§†è§‰å¸å¼•åŠ›
- **ç”¨æˆ·ä½“éªŒ**: å®Œæ•´çš„ç¼–è¾‘åŠŸèƒ½å’Œå®æ—¶é¢„è§ˆ
- **ç³»ç»Ÿå®Œæ•´æ€§**: å‰åå°æ•°æ®ç»Ÿä¸€ç®¡ç†
- **å¯æ‰©å±•æ€§**: æ”¯æŒå¤šç§å›¾åƒç”ŸæˆæœåŠ¡

### ä¸‹ä¸€æ­¥å»ºè®®

1. æ”¶é›†ç”¨æˆ·åé¦ˆ
2. ä¼˜åŒ–AIç”Ÿæˆçš„Promptæ¨¡æ¿
3. æ·»åŠ å›¾ç‰‡æ‰¹é‡ç®¡ç†åŠŸèƒ½
4. å®ç°ç‰ˆæœ¬å†å²è®°å½•
5. é›†æˆæ›´å¤šAIæœåŠ¡

---

**å®æ–½å®Œæˆæ—¶é—´**: 2025-11-01 11:10  
**æœåŠ¡çŠ¶æ€**: ğŸŸ¢ è¿è¡Œæ­£å¸¸  
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²ä¸Šçº¿  
**éªŒè¯ç»“æœ**: âœ… é€šè¿‡æ‰€æœ‰æµ‹è¯•  

**ğŸŠ ç®¡ç†å¹³å°è§’è‰²ç¼–è¾‘åŠŸèƒ½å®æ–½å®Œæˆï¼** ğŸŠ

