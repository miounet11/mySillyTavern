# SillyTavern 高级功能使用指南

## 🧙 角色卡导入与开场白（SillyTavern 兼容）

### 角色卡导入（TavernAI/SillyTavern JSON/PNG）
- 在角色列表页点击“Import”按钮，或拖拽 `.json` / `.png` 角色卡文件即可导入。
- 导入前会显示预览映射（名称、问候、场景、人物设定）。
- 支持从卡片中还原 `first_mes`、`scenario`、`personality`、`mes_example` 等字段。

### 新建对话时的问候与开场白
- 设置面板 → 界面标签页：
  - 开关“新建对话自动发送角色问候”
  - 配置“开场白模板”，支持占位符：`{{user}}`、`{{char}}`、`{{scenario}}`
- 新建对话后：
  - 若开启开关且角色有 greeting，则立即显示角色问候。
  - 输入框会预填开场白模板，等待用户编辑并发送。

## 🚀 快速开始

本指南将帮助您快速上手 SillyTavern 的所有高级功能。

---

## 📚 一、世界书（World Info）

### 什么是世界书？
世界书允许您为 AI 对话设置背景知识和上下文信息。当对话中出现特定关键词时，相关的世界书条目会自动注入到 AI 的上下文中。

### 如何使用

#### 1. 打开世界书
- 在聊天界面，点击左侧设置面板
- 点击"世界书"按钮（📖 图标）

#### 2. 添加条目
- 点击"添加条目"按钮
- 填写以下信息：
  - **注释/名称**: 条目的标识名称
  - **关键词**: 逗号分隔的触发词（如：森林, 树林, 密林）
  - **内容**: 详细的背景信息
  - **位置**: 在提示词中的插入位置（0-100）
  - **深度**: 扫描深度（回溯多少条消息）
  - **优先级**: 数值越高越优先

#### 3. 切换视图
- **表格视图**: 点击 📊 图标 - 适合批量管理
- **卡片视图**: 点击 ⊞ 图标 - 适合查看详情

#### 4. 调整参数
- **表格视图中**: 使用 ◀ ▶ 按钮快速调整位置、深度、优先级
- **编辑模式**: 使用数字输入框精确设置

#### 5. 排序和筛选
- 点击列标题进行排序
- 使用搜索框过滤条目
- 点击开关启用/禁用条目

### 💡 使用技巧
- 为常用场景创建条目（如角色背景、世界观设定）
- 使用多个关键词增加触发几率
- 高优先级条目会优先注入
- 定期检查和更新条目内容

---

## 🔧 二、正则脚本编辑器

### 什么是正则脚本？
正则脚本允许您使用正则表达式对输入/输出文本进行自动替换和格式化，实现文本美化、内容过滤等功能。

### 如何使用

#### 1. 打开编辑器
- 在聊天界面，点击左侧设置面板
- 点击"正则脚本"按钮（</> 图标）

#### 2. 创建脚本
- 点击"添加脚本"按钮
- 填写以下信息：
  - **脚本名称**: 描述性名称（如：CG描图、状态栏美化）
  - **查找（正则表达式）**: 要匹配的模式
  - **替换为**: 替换的文本（支持 $1, $2 等捕获组）
  - **脚本类型**: 
    - `输入` - 处理用户输入
    - `输出` - 处理 AI 输出
    - `显示` - 仅影响显示
    - `全部` - 处理所有文本
  - **优先级**: 执行顺序（数值越高越优先）

#### 3. 测试脚本
- 在"测试脚本"区域输入测试文本
- 点击"运行测试"查看结果
- 确认替换效果正确后保存

#### 4. 管理脚本
- **排序**: 点击优先级按钮切换升序/降序
- **导入**: 从 JSON 文件导入脚本集合
- **导出**: 保存所有脚本为 JSON 文件
- **启用/禁用**: 使用开关快速启用或禁用脚本

### 💡 使用技巧
- 从简单的替换开始，逐步增加复杂度
- 使用测试功能验证正则表达式
- 为不同场景创建不同的脚本
- 定期导出备份脚本

### 📝 示例脚本

**示例 1: CG 描图格式化**
```
查找: =<CG\|(\s\$)
替换为: $1
说明: 移除 CG 标记，保留内容
```

**示例 2: 状态栏美化**
```
查找: \[状态：(.+?)\]
替换为: <span class="status">$1</span>
说明: 为状态文本添加样式标记
```

**示例 3: 表情符号转换**
```
查找: :\)
替换为: 😊
说明: 将文本表情转换为 emoji
```

---

## 📋 三、预设管理器

### 什么是预设？
预设是预先配置的提示词模板和参数集合，可以快速切换不同的对话风格和场景。

### 如何使用

#### 1. 打开管理器
- 在聊天界面，点击左侧设置面板
- 点击"预设管理"按钮（📄 图标）

#### 2. 创建预设
- 点击"创建预设"按钮
- 填写以下信息：
  - **预设名称**: 易于识别的名称
  - **分类**: 对话/写作/编程等
  - **预设内容**: 详细的提示词和参数配置

#### 3. 管理预设
- **编辑**: 点击编辑图标修改预设
- **复制**: 点击复制图标创建副本
- **删除**: 点击删除图标移除预设
- **启用/禁用**: 使用开关控制预设状态

#### 4. 排序和筛选
- 按**名称**或**更新时间**排序
- 使用搜索框快速查找
- 点击列标题切换升序/降序

#### 5. 导入导出
- **导出**: 保存所有预设为 JSON 文件
- **导入**: 从 JSON 文件导入预设

### 💡 使用技巧
- 为不同角色/场景创建专用预设
- 定期更新预设内容
- 使用复制功能快速创建变体
- 给预设起清晰的名称和分类

### 📝 预设示例

**示例 1: 标准对话**
```
名称: 标准对话
分类: 对话
内容: 你是一个友好且乐于助人的AI助手。请用礼貌、清晰的语言回答问题，
      提供准确的信息，并在必要时询问澄清性问题。
```

**示例 2: 创意写作**
```
名称: 创意写作
分类: 写作
内容: 你是一个富有创造力的作家。请用生动、富有想象力的语言进行写作，
      注重细节描写，营造氛围，创造引人入胜的故事情节。
```

**示例 3: 技术助手**
```
名称: 技术助手
分类: 编程
内容: 你是一个经验丰富的程序员。请提供清晰的技术解释，包含代码示例，
      遵循最佳实践，并解释为什么这样做。
```

---

## 🌳 四、剧情分支管理

### 什么是剧情分支？
剧情分支功能让您可视化对话的所有分支路径，随时回到之前的节点，探索不同的对话方向。

### 如何使用

#### 1. 打开分支视图
- 在聊天界面，点击左侧设置面板
- 点击"剧情分支管理"按钮（🌲 图标）

#### 2. 浏览分支树
- **树状结构**: 显示所有对话节点和它们的关系
- **节点标识**: 
  - 蓝色 = 用户消息
  - 紫色 = AI 消息
  - 青色高亮 = 当前节点
- **分支计数**: 显示每个节点有多少个子分支

#### 3. 导航和操作
- **展开/折叠**: 点击 ▼ ▶ 按钮
- **查看详情**: 点击节点卡片
- **跳转**: 在详情面板点击"跳转到此节点"
- **编辑**: 点击编辑图标修改节点
- **删除**: 点击删除图标移除节点及其子树

#### 4. 侧边栏详情
- 显示选中节点的完整信息
- 包括：ID、角色、内容、子分支数、时间戳
- 提供快捷操作按钮

### 💡 使用技巧
- 定期查看分支树了解对话流程
- 尝试不同的对话分支探索可能性
- 删除不满意的分支保持树的整洁
- 在重要决策点创建多个分支

---

## ✏️ 五、节点编辑器

### 什么是节点编辑？
节点编辑器允许您修改对话历史中的消息内容和记忆摘要，微调对话体验。

### 如何使用

#### 1. 打开编辑器
- 在剧情分支管理中，点击节点的编辑图标
- 或在详情面板点击"编辑节点"按钮

#### 2. 编辑界面
- **左侧面板**: 记忆摘要编辑
  - 编辑 AI 对此节点的记忆
  - 支持 Markdown 格式
  - 用于调整 AI 的上下文理解
  
- **右侧面板**: 消息内容编辑
  - 编辑实际的消息文本
  - 显示字符计数
  - 显示时间戳和角色信息

#### 3. 保存更改
- 点击"保存更改"应用修改
- 点击"取消"放弃更改

### 💡 使用技巧
- 使用记忆摘要引导 AI 的理解
- 用 Markdown 格式组织记忆（## 章节、- 列表）
- 修正 AI 的错误理解
- 优化对话流程和逻辑

### 📝 Markdown 格式示例

```markdown
## 记忆摘要

### 关键信息
- 用户询问了关于项目的信息
- AI 提供了详细的解释
- 讨论了未来的计划

### 重要细节
- 项目名称: SillyTavern
- 开发语言: TypeScript
- 框架: Next.js

### 后续行动
- 继续完善功能
- 优化用户体验
```

---

## ⚙️ 六、综合使用场景

### 场景 1: 创建沉浸式角色扮演体验

1. **设置世界观** (世界书)
   - 创建世界设定条目
   - 添加角色背景信息
   - 设置地点和物品描述

2. **配置文本美化** (正则脚本)
   - 添加状态栏格式化脚本
   - 配置对话框美化
   - 设置表情符号转换

3. **选择对话风格** (预设)
   - 加载角色扮演预设
   - 调整 AI 的语言风格

4. **探索多个结局** (分支管理)
   - 在关键决策点创建分支
   - 尝试不同的对话选项
   - 比较不同分支的结果

### 场景 2: 写作辅助

1. **准备素材** (世界书)
   - 添加故事设定
   - 记录角色信息
   - 创建情节大纲

2. **格式化输出** (正则脚本)
   - 自动添加段落标记
   - 格式化对话引用
   - 美化特殊符号

3. **切换写作风格** (预设)
   - 创建不同类型的预设
   - 快速切换叙事视角

4. **管理剧情版本** (分支管理)
   - 保存不同的故事走向
   - 比较不同版本
   - 选择最佳剧情

### 场景 3: 技术学习

1. **构建知识库** (世界书)
   - 添加技术概念
   - 记录代码示例
   - 整理学习笔记

2. **格式化代码** (正则脚本)
   - 自动代码高亮
   - 格式化输出
   - 添加注释标记

3. **专业助手模式** (预设)
   - 配置技术助手预设
   - 设置代码风格偏好

---

## 🎯 最佳实践

### 1. 世界书
- ✅ 使用清晰的关键词
- ✅ 保持内容简洁明了
- ✅ 定期更新和维护
- ✅ 合理设置优先级
- ❌ 避免关键词重叠
- ❌ 避免内容过于冗长

### 2. 正则脚本
- ✅ 先测试后启用
- ✅ 使用描述性名称
- ✅ 保持脚本简单
- ✅ 定期备份导出
- ❌ 避免过于复杂的正则
- ❌ 避免脚本冲突

### 3. 预设
- ✅ 为不同场景创建专用预设
- ✅ 使用清晰的分类
- ✅ 定期优化内容
- ✅ 分享优秀预设
- ❌ 避免预设过多
- ❌ 避免内容过时

### 4. 分支管理
- ✅ 在重要节点创建分支
- ✅ 删除无用分支
- ✅ 定期整理树结构
- ❌ 避免分支过度复杂

---

## 🔧 快捷键和技巧

### 通用操作
- **Esc**: 关闭任何打开的面板
- **搜索框**: 实时过滤，支持模糊匹配
- **排序**: 点击列标题或排序按钮

### 表格视图
- **◀ ▶**: 快速调整数值
- **开关**: 快速启用/禁用
- **悬停**: 显示完整内容

### 编辑器
- **Ctrl + Enter**: 保存（部分编辑器）
- **Esc**: 取消编辑

---

## ❓ 常见问题

### Q: 世界书条目什么时候会被触发？
A: 当对话中出现条目的任意关键词时，该条目会被注入到 AI 的上下文中。

### Q: 正则脚本的优先级如何工作？
A: 数值越高越优先执行。相同优先级按创建顺序执行。

### Q: 如何备份我的设置？
A: 每个功能都提供导出功能，可以将数据保存为 JSON 文件。

### Q: 分支管理会影响实际对话吗？
A: 切换到不同分支会改变对话的当前状态和历史。

### Q: 可以同时使用多个预设吗？
A: 当前版本每次只能使用一个预设，但可以快速切换。

---

## 📞 获取帮助

如果您遇到问题或需要帮助：

1. 查看界面上的提示信息（💡 图标）
2. 查看本指南的相关章节
3. 尝试重新加载页面
4. 检查控制台是否有错误信息

---

## 🎉 开始使用！

现在您已经了解了所有高级功能，开始探索和使用它们吧！

记住：
- 从简单开始，逐步探索
- 多尝试，找到最适合您的工作流程
- 定期备份您的设置和数据
- 享受创作的乐趣！

**祝您使用愉快！** 🚀

